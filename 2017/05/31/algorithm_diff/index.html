<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//koala.ink/lib/google-fonts/fonts.css" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="DIFF,LCS,SED,DP,"><link rel="alternate" href="/atom.xml" title="KoalaInk" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.1"><meta name="description" content="什么是Diff在日常工作中，diff是大家常用的一个工具，它能快速的计算出两个文本的差异，并将差异结果一目了然的展示出来，帮助我们快速定位在不同版本中文件的修改位置。"><meta property="og:type" content="article"><meta property="og:title" content="Diff算法与实现"><meta property="og:url" content="http://koala.ink/2017/05/31/algorithm_diff/index.html"><meta property="og:site_name" content="KoalaInk"><meta property="og:description" content="什么是Diff在日常工作中，diff是大家常用的一个工具，它能快速的计算出两个文本的差异，并将差异结果一目了然的展示出来，帮助我们快速定位在不同版本中文件的修改位置。"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/diff_simple_flowchart.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/lcs_formula.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/lcs_map.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/lcs_map_mark.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/sed_formula1.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/sed_formula2.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/two_edits1.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/two_edits2.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/semantics.jpeg"><meta property="og:image" content="http://koala.ink/posts_assets/algorithm_diff/diff_flowchart.jpeg"><meta property="og:updated_time" content="2018-02-13T10:15:54.284Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Diff算法与实现"><meta name="twitter:description" content="什么是Diff在日常工作中，diff是大家常用的一个工具，它能快速的计算出两个文本的差异，并将差异结果一目了然的展示出来，帮助我们快速定位在不同版本中文件的修改位置。"><meta name="twitter:image" content="http://koala.ink/posts_assets/algorithm_diff/diff_simple_flowchart.jpeg"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"Author"}}</script><link rel="canonical" href="http://koala.ink/2017/05/31/algorithm_diff/"><title> Diff算法与实现 | KoalaInk</title><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-1951963209134581",enable_page_level_ads:!0})</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-85041097-1","auto"),ga("send","pageview")</script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?2ae34fe5bc74dabbd220968d235776a5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div style="display:none"><script src="http://s95.cnzz.com/z_stat.php?id=1260520941&web_id=1260520941" language="JavaScript"></script></div><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">KoalaInk</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Internet King —— Koala</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> Tags</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> About</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div> <span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> Diff算法与实现</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time itemprop="dateCreated" datetime="2017-05-31T18:02:08+08:00" content="2017-05-31">2017-05-31</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a></span> , <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/Algorithm/Diff/" itemprop="url" rel="index"><span itemprop="name">Diff</span></a></span></span> <span id="/2017/05/31/algorithm_diff/" class="leancloud_visitors" data-flag-title="Diff算法与实现">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">visitors&nbsp;</span><span class="leancloud-visitors-count"></span></span></div><div class="post-banner"> <img src="/posts_assets/algorithm_diff/banner.jpeg"></div></header><div class="post-body" itemprop="articleBody"><h2 id="什么是Diff"><a href="#什么是Diff" class="headerlink" title="什么是Diff"></a>什么是Diff</h2><p>在日常工作中，diff是大家常用的一个工具，它能快速的计算出两个文本的差异，并将差异结果一目了然的展示出来，帮助我们快速定位在不同版本中文件的修改位置。</p><a id="more"></a><p><img style="margin:0 auto" width="300" src="/posts_assets/algorithm_diff/diff_simple_flowchart.jpeg" alt="Diff简单流程图"></p><p>以上流程图简单描述了我们使用diff程序的流程，只需往diff程序中输入text1与text2（我们规定，text1为初始文本，text2为编辑文本），diff程序会自动计算出两个文本的差异并可视化输出。</p><p>在这篇文章中，将会简单的谈一谈diff程序内部流程是如何流转并实现的，以及介绍在实现过程中会遇到的一些算法问题。</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>举个简单的例子：<br></p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">text1: <span class="built_in">console</span>.log(<span class="string">'hello world'</span>);</div><div class="line">text2: <span class="built_in">console</span>.log(<span class="string">'hi js'</span>);</div></pre></td></tr></table></figure><p></p><p><span>console.log(‘h</span><del style="background:#ffe6e6">ello</del><ins style="background:#e6ffe6">i</ins><span>&nbsp;</span><del style="background:#ffe6e6">world</del><ins style="background:#e6ffe6">js</ins><span>‘);</span></p><p>从结果中我们可以看出，diff程序的可视化输出，无非是将文本中未改变的部分原样输出，其余字符，若是在text1中，则被标记为删除；若是在text2中，则被标记为新增。如下使用红色标记两个文本的未改变部分：<br>text1: <font color="red">console.log(‘h</font>ello<font color="red">-</font>world<font color="red">‘);</font><br>text2: <font color="red">console.log(‘h</font>i<font color="red">-</font>js<font color="red">‘);</font><br>红色部分除外，在text1中的<code>ello</code>和<code>world</code>在结果中都将被标记为删除；text2中的<code>i</code>和<code>js</code>在结果中都将被标记为新增。<br>因此，diff程序的关键就在于如何找到text1与text2所有相同文本（即找到标记红色的文本），然后再分别标记出剩下的删除或新增文本即可。</p><h2 id="如何diff"><a href="#如何diff" class="headerlink" title="如何diff"></a>如何diff</h2><h3 id="LCS"><a href="#LCS" class="headerlink" title="LCS"></a>LCS</h3><p>计算两个文本相同部分的问题，即求两个字符串的最长公共子序列(Longest Common Subsequence，简称LCS)问题，介绍LCS问题解法之前，先了解以下概念。</p><h4 id="Subsequence-NOT-Substring"><a href="#Subsequence-NOT-Substring" class="headerlink" title="Subsequence(NOT Substring)"></a>Subsequence(NOT Substring)</h4><p>设序列Xm=<code>&lt;x1, x2, …, xm&gt;</code>，从Xm序列中任意取出若干个元素，按照元素下标从小到大的顺序排列得到一个新的序列Zk=<code>&lt;z1, z2, ..., zk&gt;</code>，则Zk为Xm的一个子序列。子序列只要求元素的前后位置关系与原序列中保持一致即可，不必保证元素必需是连续的。</p><h4 id="公共子序列"><a href="#公共子序列" class="headerlink" title="公共子序列"></a>公共子序列</h4><p>给出两个序列Xm与Yn，找到一个序列Zk，满足：Zk即是Xm的子序列，又是Yn的子序列，则Zk为Xm与Yn的一个公共子序列</p><h4 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h4><p>给出两个序列Xm与Yn，找到一个Xm与Yn的公共子序列Zk，Zk的长度是Xm与Yn所有公共子序列中长度最长的一个。</p><h4 id="暴力美学"><a href="#暴力美学" class="headerlink" title="暴力美学"></a>暴力美学</h4><p>最简单直接的，就是暴力求解，如下为暴力法求解LCS的伪代码：<br></p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">Zk = 空</div><div class="line"><span class="keyword">for</span> Xm的所有子序列 Zx</div><div class="line">  <span class="keyword">if</span> Zx是Yn的子序列 &amp;&amp; Zx长度大于Zk</div><div class="line">    Zk = Zx</div></pre></td></tr></table></figure><p></p><p>一个长度为m的序列，存在2^m个子序列；判断Zx序列是否为Yn序列的子序列，时间复杂度为O(n)；因此暴力求解算法的时间复杂度为O(n*2^m)。指数级别时间复杂度的算法，基本上是要把电脑搞挂的，这显然不是我们想要的结果。</p><h4 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h4><p>动态规划一般也只能应用于有最优子结构的问题。最优子结构的意思是局部最优解能决定全局最优解(对有些问题这个要求并不能完全满足，故有时需要引入一定的近似)。简单地说，问题能够分解成子问题来解决。<br>使用动态规划算法求解最优解的时候，最关键的问题在于如何找到最优解问题的转化方程。</p><p>设序列Xm=<code>&lt;x1, x2, …, xm&gt;</code>和Yn=<code>&lt;y1, y2, …, yn&gt;</code>的一个最长公共子序列Zk=<code>&lt;z1, z2, …, zk&gt;</code>，则：</p><ol><li>若xm=yn，可以使用反证法证明：xm(yn)必然是Zk的最后一个字符，即zk=xm=yn，且Zk-1是Xm-1和Yn-1的最长公共子序列。因此 <code>LCS(X, Y)</code> 即可以转化成 <code>LCS(Xm-1, Yn-1) + 1</code>；</li><li>若xm≠yn且zk≠xm ，亦可用反证法证明：Z是Xm-1和Y的最长公共子序列；</li><li>若xm≠yn且zk≠yn ，同第二点，可得出Z是X和Yn-1的最长公共子序列。<br>其中：Xm-1=<code>&lt;x1, x2, …, xm-1&gt;</code>，Yn-1=<code>&lt;y1, y2, …, yn-1&gt;</code>，Zk-1=<code>&lt;z1, z2, …, zk-1&gt;</code>。</li></ol><p>整合2、3点的结论，得出当xm≠yn时，可以将 <code>LCS(X, Y)</code> 转化成 <code>MAX(LCS(Xm-1, Y), LCS(X, Yn-1))</code>。</p><p>设dp[i][j]表示序列Xi和Yj的一个最长公共子序列Zk的长度，即dp[i][j] = k。<br>因此我们可以得到以下公式：<br><img src="/posts_assets/algorithm_diff/lcs_formula.jpeg" alt="LCS公式"></p><p>根据此公式，我们定义一个二维数组dp，size为m*n，dp数组中的每个元素的值，都可以通过其左上/左/上三个方位的单元格得到，因此我们只需顺序填满dp表格，在dp[m][n]处就可以得到Xm与Yn的最长公共子序列长度。如下所示(X: ABCABBA, Y: CBABAC)：<br><img style="margin:0 auto" width="300" src="/posts_assets/algorithm_diff/lcs_map.jpeg" alt="lcs dp表格"></p><p>仅仅得到最长公共子序列的长度显然不足以达到我们的目的，为了能够得到一个完整的LCS，我们在计算dp表格的过程中，还需要同时记录计算每个单元格值的来源位置，使用<code>↖︎</code>、<code>↑</code>、<code>←</code>三个字符来表示，如下图（若dp[i-1][j]与dp[i][j-1]相等时，默认取左边单元格，即dp[i][j-1]）：<br><img style="margin:0 auto" width="300" src="/posts_assets/algorithm_diff/lcs_map_mark.jpeg" alt="lcs map"><br>在上图的表格中，我们只需要从最右下角的单元格开始，按照箭头的指示就可以一步步往左上角靠近，如图中标记红色的路线。在此路线中，<code>←</code>符号表示Y扫过一个字符，此字符需标记为新增；<code>↑</code>符号表示X扫过一个字符，此字符需标记为删除；<code>↖︎</code>表示X、Y同时扫过一个字符，此字符为LCS中的元素，为未改变字符。<br>如上操作，我们就可以得到X与Y的一个<span><del style="background:#ffe6e6">AB</del><span>C</span><del style="background:#ffe6e6">A</del><span>B</span><ins style="background:#e6ffe6">A</ins><span>BA</span><ins style="background:#e6ffe6">C</ins></span></p><p>至此我们已经可以实现一个简单的diff程序了。<br><a href="/rush/algorithm_diff/lib/diff_match.js">前往阅读“阉割版”Diff插件源码</a><br><a href="/rush/algorithm_diff/index.html">点我查看“阉割版”Diff插件Demo演示</a></p><h3 id="SED"><a href="#SED" class="headerlink" title="SED"></a>SED</h3><p>除了上面介绍的LCS算法之外，最短编辑距离(Shortest Edit Distance，简称SED)算法同样可以用来实现文本diff。<br>SED问题的描述是：给出两个字符串text1与text2，求将text1编辑成text2所需要的最短编辑距离。定义有效的编辑操作有：删除一个字符、新增一个字符、替换一个字符，其中一次删除或新增操作编辑距离记为1，替换操作的编辑距离记为2（因为一个替换操作相当于一个删除操作加上一个新增操作）。</p><p>仔细观察可以发现，SED问题其实是LCS问题的一个逆向描述。LCS求尽可能多的相同部分，而SED求尽可能少的编辑部分（即不同部分）。他们必然满足一个关系：<code>m + n === 2 * LCS(X, Y) + SED(X, Y);</code> 其中m、n分别为X与Y的长度。因此SED问题的结果与LCS是等效的，求解SED问题同样可以使用动态规划的思想来解，只是在公式上有所不同罢了，以下给出SED的求解公式：</p><p>设f[i][j]表示从字符xi转化成yj的编辑距离；<br>设dp[i][j]表示序列Xi=<code>&lt;x1, x2, …, xi&gt;</code>转化成Yj=<code>&lt;y1, y2, …, yj&gt;</code>的最短编辑距离；</p><p><img style="width:50%;margin:0 auto" src="/posts_assets/algorithm_diff/sed_formula1.jpeg" alt="LCS公式 f"><br><img src="/posts_assets/algorithm_diff/sed_formula2.jpeg" alt="LCS公式 dp"></p><p>同样，根据公式，依次填满dp表格，同时标记上每个单元格的来源方位，即可找到两个文本的差异，演算过程类似LCS，在此不再赘述。</p><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>上面介绍的LCS与SED算法，时间复杂度都是O(n*m)，因此精确计算LCS/SED是非常耗费性能的。<br>对于基于字符的diff程序，n与m分别为text1与text2的字符数。一个简单有效的优化方式就是转化成基于行的diff，转化后n与m分别为text1与text2的行数，这就可以大大加速diff的耗时，同时也使得diff结果更具语义(svn/git 的diff命令，就是基于行的diff)。</p><h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><p>除了转化成基于行的diff之外，在进行LCS/SED之前，可以进行以下预处理操作来加速diff程序</p><h4 id="Equality"><a href="#Equality" class="headerlink" title="Equality"></a>Equality</h4><p>简单的判断text1与text2是否全等，可以免去许多不必要的计算。在一个庞大的项目库中，往往每次修改的文件只是其中很小的一部分，因此绝大部分的文件都可以通过判断内容是否全等直接得到结果，无需再进行LCS/SED计算。</p><h4 id="Common-Prefix-Suffix"><a href="#Common-Prefix-Suffix" class="headerlink" title="Common Prefix/Suffix"></a>Common Prefix/Suffix</h4><p>提取text1与text2的公共前缀与后缀，再对剩余部分进行diff，可以缩小text1与text2的diff范围。提取公共前缀/后缀的操作，可以使用二分查找的算法，可以在O(logn)的时间复杂度内完成(log以2为底数)。</p><h4 id="Singular-Insertion-Deletion"><a href="#Singular-Insertion-Deletion" class="headerlink" title="Singular Insertion/Deletion"></a>Singular Insertion/Deletion</h4><p>在上一步提取完公共前缀/后缀之后，若是text1剩下的为空字符串，则表示仅仅是新增了text2剩下部分的字符串；若是text2剩下的为空字符串，则表示仅仅是删除了text1剩下部分的字符串。因此在这种情况下，也可以直接得到结果，无需再进行LCS/SED计算。</p><h4 id="Two-Edits"><a href="#Two-Edits" class="headerlink" title="Two Edits"></a>Two Edits</h4><p>同样再提取公共前缀/后缀之后，剩余部分在头尾都不会有相同的字符，但是在中间部分可能仍有大量的相同部分，若我们能找到剩余部分的一个公共子串，该公共子串可以将text1、text2剩余部分都分割成两个部分[text1_pre, text1_suf]、[text2_pre, text2_suf]，那么我们就可以转化成求diff(text1_pre, text2_pre)和diff(text1_suf, text2_suf)，再将得到的结果拼接在一起，就可以得到完整的diff结果。为了保证这个分割是有效的，可以规定这个公共字串的长度必需大于较长串长度的二分之一。</p><p>计算最长公共子串仍然是一个复杂的程序，但是我们可以利用满足长度大于二分之一较长串长度的特殊条件，进行特殊查找即可。</p><p><img style="width:50%;margin:0 auto" src="/posts_assets/algorithm_diff/two_edits1.jpeg" alt="two_edits1"></p><p>拖动一个二分之一长度的字符串，我们可以发现，这个字符串必然会包含第二个四分之一子串（图中红色部分）或者第三个四分之一子串。利用这个关系，我们只需要分别取这个四分之一子串，判断是否是另一个字符串的子串，若是，则先用此四分之一子串将两个字符串分隔开，如下图所示，分别求前部分的公共后缀，以及后半部分的公共前缀，然后将<code>公共后缀+四分之一子串+公共前缀</code>即可得到一个公共子串，如此求完所有的公共子串，取最长的一个，判断其长度是否大于长串的二分之一即可。</p><p><img style="width:50%;margin:0 auto" src="/posts_assets/algorithm_diff/two_edits2.jpeg" alt="two_edits2"></p><h3 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h3><p>后处理主要是将前面计算得到的diffs数组进行merge合并，并且做一些语义化的处理，是的输出结果更具语义，利于阅读。</p><h4 id="Semantics"><a href="#Semantics" class="headerlink" title="Semantics"></a>Semantics</h4><p>对于下图所示的例子，以下计算出的6个diff结果都是等效的。之所以有这么多等效的结果，是因为diffs的编辑具有可移动性。若一个编辑操作的左右两边都是相同部分，满足：</p><ol><li>编辑部分的第一个字符等于其后相同部分的第一个字符，则此编辑部分可右移一个元素；</li><li>编辑部分的最后一个字符等于其前面相同部分的第一个字符，则此编辑部分可左移一个元素。</li></ol><p><img style="width:60%;margin:0 auto" src="/posts_assets/algorithm_diff/semantics.jpeg" alt="semantics"></p><p>这6个diff结果中，显然Diff 3与Diff 4是更具有语义的，因此，我们可以指定一个规则，给每个diff结果进行一个评分，得分高的diff结果，则表示它更具有语义。可以有一下几点评分项目：</p><ol><li>编辑的边界是一个非字母数字字符，1分；</li><li>编辑的边界是一个空白符，2分；</li><li>编辑的边界是一个换行符，3分；</li><li>编辑的边界是一个空行，4分；</li><li>编辑的边界不再是相等部分（移动消耗了整个相等部分），5分。</li></ol><p>依据以上几点评分规则，我们可以得到，Diff 1、2、5、6的结果，的0分；Diff 3、4的结果，因为边界分别有两个空白符，因此得4分。所以程序就可以判断出，Diff 3、4得结果，才是更具有语义的。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总结以上的描述，我们可以得出以下完整的Diff程序流程图：</p><p><img src="/posts_assets/algorithm_diff/diff_flowchart.jpeg" alt="diff程序流程图"></p><h2 id="阅读资料"><a href="#阅读资料" class="headerlink" title="阅读资料"></a>阅读资料</h2><p><a href="https://neil.fraser.name/writing/diff/">Diff Strategies</a><br><a href="https://neil.fraser.name/software/diff_match_patch/myers.pdf">An O(ND) Difference Algorithm and Its Variations∗</a></p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/DIFF/" rel="tag">#DIFF</a> <a href="/tags/LCS/" rel="tag">#LCS</a> <a href="/tags/SED/" rel="tag">#SED</a> <a href="/tags/DP/" rel="tag">#DP</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/05/17/git_cmd/" rel="next" title="Git 常用指令整理"><i class="fa fa-chevron-left"></i> Git 常用指令整理</a></div><div class="post-nav-prev post-nav-item"> <a href="/2017/06/02/leetcode_1_two_sum/" rel="prev" title="LeetCode —— Two Sum">LeetCode —— Two Sum<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div onclick="ShowGitment()" id="gitment-display-button">Show comments from Gitment</div><div id="gitment-container" style="display:none"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview"> Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Koala.ink"><p class="site-author-name" itemprop="name">Koala.ink</p><p class="site-description motion-element" itemprop="description">Coding my future.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">34</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">17</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">36</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/koalaink" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Diff"><span class="nav-number">0.</span> <span class="nav-text">什么是Diff</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题分析"><span class="nav-number">1.</span> <span class="nav-text">问题分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何diff"><span class="nav-number">2.</span> <span class="nav-text">如何diff</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LCS"><span class="nav-number">2.0.</span> <span class="nav-text">LCS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Subsequence-NOT-Substring"><span class="nav-number">2.0.0.</span> <span class="nav-text">Subsequence(NOT Substring)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#公共子序列"><span class="nav-number">2.0.1.</span> <span class="nav-text">公共子序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最长公共子序列"><span class="nav-number">2.0.2.</span> <span class="nav-text">最长公共子序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#暴力美学"><span class="nav-number">2.0.3.</span> <span class="nav-text">暴力美学</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态规划"><span class="nav-number">2.0.4.</span> <span class="nav-text">动态规划</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SED"><span class="nav-number">2.1.</span> <span class="nav-text">SED</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化"><span class="nav-number">3.</span> <span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#预处理"><span class="nav-number">3.0.</span> <span class="nav-text">预处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Equality"><span class="nav-number">3.0.0.</span> <span class="nav-text">Equality</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Common-Prefix-Suffix"><span class="nav-number">3.0.1.</span> <span class="nav-text">Common Prefix/Suffix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Singular-Insertion-Deletion"><span class="nav-number">3.0.2.</span> <span class="nav-text">Singular Insertion/Deletion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Two-Edits"><span class="nav-number">3.0.3.</span> <span class="nav-text">Two Edits</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后处理"><span class="nav-number">3.1.</span> <span class="nav-text">后处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Semantics"><span class="nav-number">3.1.0.</span> <span class="nav-text">Semantics</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#阅读资料"><span class="nav-number">5.</span> <span class="nav-text">阅读资料</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 - <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-fw fa-github"></i></span> <span class="author" itemprop="copyrightHolder"><a class="hosted-link" href="/">Koala.ink</a></span></div><div class="hosted-on"> Hosted on<a class="hosted-link" href="https://github.com/koalaink/koalaink.github.io"><i class="fa fa-fw fa-github"></i> GitHub</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script type="text/javascript">function ShowGitment(){document.getElementById("gitment-display-button").style.display="none",document.getElementById("gitment-container").style.display="block";var e=new Gitment({id:document.location.href,owner:"KoalaInk",repo:"koalaink.github.io",oauth:{client_id:"050fc13519ecf4c906f1",client_secret:"3089171e76120c5937013151ad8577141fde9141"}});e.render("gitment-container")}</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),s=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!0,s=r.title.trim().toLowerCase(),n=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url,o=-1,l=-1,p=-1;if(""!=s&&""!=n&&a.forEach(function(e,t){o=s.indexOf(e),l=n.indexOf(e),o<0&&l<0?c=!1:(l<0&&(l=0),0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+i+"' class='search-result-title'>"+s+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),s.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("MAsnSi44NPvCiO2yaUFaS9xP-gzGzoHsz","KbDduhEI6reqUU4FFU5Jz1wk")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),c=s.get("time"),l=document.getElementById(r);$(l).find(t).text(c)}for(var i=0;i<n.length;i++){var r=n[i],l=document.getElementById(r),u=$(l).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e,t){var n=$(".leancloud_visitors"),o=n.attr("id").trim(),i=n.attr("data-flag-title").trim(),s=new AV.Query(e);s.equalTo("url",o),s.find({success:function(t){if(t.length>0){var n=t[0];n.fetchWhenSave(!0),n.increment("time"),n.save(null,{success:function(e){var t=$(document.getElementById(o));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",i),s.set("url",o),s.set("time",1),s.save(null,{success:function(e){var t=$(document.getElementById(o));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}});var r=new t,c=new AV.ACL;c.setPublicReadAccess(!0),c.setPublicWriteAccess(!0),r.setACL(c),r.set("title",i),r.set("url",o),r.set("time",1),r.save(null,{success:function(e){},error:function(e,t){console.log("Failed to create")}})}$(function(){var e=AV.Object.extend("Counter"),t=AV.Object.extend("History");1==$(".leancloud_visitors").length?addCount(e,t):$(".post-title-link").length>1&&showTime(e)})</script></body></html>