!function(e){var t=function(){function t(t){var l={sideMenu:"side-menu",menuTitle:"menu-title",menuItems:"menu-items",menuItem:"menu-item",menuItemTitle:"menu-item-title",subMenuItems:"sub-menu-items",subMenuItem:"sub-menu-item",subMenuItemTitle:"sub-menu-item-title",subMenuItemLevel:"sub-menu-level",hasFold:"item-hasFold",unfoldItem:"item-unfolded",curItem:"item-curr",scrolling:"on-scrolling"};return e.each(l,function(e,s){l[e]=t+"-"+s}),l}function l(){var e={sideMenu:"<div class='{cls}'>{title}{items}</div>",menuTitle:"<div class='{cls}'><h3>{title}</h3></div>",items:"<ul class='{cls}'>{items}</ul>",item:"<li class='{cls}' id='{id}'>{title}{subItems}</li>",title:"<div class='{cls}'><i></i><span><a href='{href}'>{title}</a></span></div>"};return e}function s(t,l){var s=o.tpl.item,i=o.tpl.title.replace("{cls}","{cls} "+o.cls.subMenuItemLevel+l);return 1===l?(s=s.replace("{cls}",o.cls.menuItem+(t.subItems?" "+o.cls.hasFold:"")+(t.cls?" "+t.cls:"")),t.cls=o.cls.menuItemTitle):(s=s.replace("{cls}",o.cls.subMenuItem+(t.subItems?" "+o.cls.hasFold:"")+(t.cls?" "+t.cls:"")),t.cls=o.cls.subMenuItemTitle),"href"in t||(i=i.replace("href='{href}'","")),e.each(t,function(e,t){i=i.replace("{"+e+"}",t)}),s=s.replace("{title}",i),s="id"in t?s.replace("{id}",t.id):s.replace("id='{id}'",""),s="subItems"in t?s.replace("{subItems}",n(t.subItems,l+1)):s.replace("{subItems}","")}function n(t,l){var n="";return e.each(t,function(e,t){n+=s(t,l)}),n=o.tpl.items.replace("{items}",n),n=1===l?n.replace("{cls}",o.cls.menuItems):n.replace("{cls}",o.cls.subMenuItems)}function i(){var e,t="";return e=o.tpl.sideMenu.replace("{cls}",o.cls.sideMenu),"title"in o.o&&(t=o.tpl.menuTitle.replace("{cls}",o.cls.menuTitle+(o.o.cls?" "+o.o.cls:"")),t=t.replace("{title}",o.o.title)),e=e.replace("{title}",t),e=e.replace("{items}",n(o.o.items,1))}var o=this;o.o={fixed:!1,width:350,prefix:"x"},o.init=function(s,n){return n&&e.extend(o.o,n),o.el=s,o.cls=t(o.o.prefix),o.tpl=l(),o.renderMenu(),o.playMenu(),o.o.fixed&&o.fixedMenu(),o},o.renderMenu=function(){o.menu=e(i()),o.menu.css("width",o.o.width),o.el.append(o.menu)},o.playMenu=function(){o.menu.find("ul."+o.cls.menuItems+" ul").hide(),o.menu.find("."+o.cls.unfoldItem+" > ul").show(),o.titles=o.menu.find("."+o.cls.menuItemTitle+",."+o.cls.subMenuItemTitle),o.titles.on("click",function(){o.clickTitle(e(this),o.cls.curItem)})},o.callback=function(){o.o.fixed&&e(window).trigger("scroll")},o.foldItem=function(e,t){e.hasClass(t)&&(e.find("ul").slideUp("fast",o.callback),e.find("."+t).removeClass(t),e.removeClass(t))},o.unfoldItem=function(t,l){t.hasClass(l)||(t.addClass(l),t.children("ul").slideDown("fast",o.callback),t.siblings().each(function(){o.foldItem(e(this),l)}))},o.foldToggle=function(e,t){e.hasClass(t)?o.foldItem(e,t):o.unfoldItem(e,t)},o.changeCurItem=function(e,t){o.curItem&&o.curItem.removeClass(t),o.curItem=e,o.curItem.addClass(t)},o.clickTitle=function(e,t){o.changeCurItem(e,t),o.foldToggle(e.closest("li"),o.cls.unfoldItem)},o.resizeMenuHeight=function(){o.height=o.menu.height(),o.el.css("min-height",o.height),o.maxScrollTop=o.o.offset.offset().top+o.o.offset.height()-o.height},o.fixedMenu=function(){o.o.offset=e(o.o.offset),o.wHeight=e(window).height(),o.resizeMenuHeight(),e(window).on("scroll",function(){o.relocateMenu(e(this))}),e(window).on("resize",function(){o.wHeight=e(window).height(),o.relocateMenu(e(this))}),o.menu.on("mouseenter",o.menuMouseEnter),o.menu.on("mouseleave",o.menuMouseLeave),e("body").on("mousewheel",function(e){o.menu.hasClass(o.cls.scrolling)&&(o.menuScroll(e)&&e.preventDefault(),e.stopPropagation())})},o.menuMouseEnter=function(){o.menu.addClass(o.cls.scrolling)},o.menuMouseLeave=function(){o.menu.removeClass(o.cls.scrolling)},o.menuScroll=function(e){return!(o.height<=o.wHeight||o.scrollTop<=o.offset.top||o.scrollTop>o.maxScrollTop)&&(o.locateMenu(-e.originalEvent.wheelDelta),!0)},o.relocateMenu=function(e){o.offset=o.el.offset();var t=e.scrollTop()-o.scrollTop;t=t>=0?0:t,o.scrollTop=e.scrollTop(),o.scrollLeft=e.scrollLeft(),o.resizeMenuHeight(),o.locateMenu(t)},o.locateMenu=function(e){var t=-parseInt(o.menu.css("top"));t+=e,t=t<=0?0:t,t=o.height>o.wHeight&&(t>o.height-o.wHeight&&o.height-o.wHeight||t),o.scrollTop<=o.offset.top+t?o.menu.css({position:"relative",top:0,left:0}):o.scrollTop<=o.maxScrollTop+t?o.menu.css({position:"fixed",top:-t,left:o.offset.left-o.scrollLeft}):o.menu.css({position:"fixed",top:o.maxScrollTop-o.scrollTop,left:o.offset.left-o.scrollLeft})}};e.fn.menu=function(l){var s=this.length;return this.each(function(n){var i=e(this),o="menu"+(s>1?"-"+ ++n:""),u=(new t).init(i,l);i.data(o,u).data("key",o)})}}(jQuery);