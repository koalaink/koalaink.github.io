<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//koala.ink/lib/google-fonts/fonts.css" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="JS,"><link rel="alternate" href="/atom.xml" title="KoalaInk" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.1"><meta name="description" content="译文链接：Javascript实用黑科技45条
本文是一篇翻译文章。原文： 45 Useful JavaScript Tips, Tricks and Best Practices  

译文开始。"><meta property="og:type" content="article"><meta property="og:title" content="[转]Javascript实用黑科技45条"><meta property="og:url" content="http://koala.ink/2015/11/09/javascript_45_black_tech/index.html"><meta property="og:site_name" content="KoalaInk"><meta property="og:description" content="译文链接：Javascript实用黑科技45条
本文是一篇翻译文章。原文： 45 Useful JavaScript Tips, Tricks and Best Practices  

译文开始。"><meta property="og:updated_time" content="2018-02-13T10:15:54.288Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="[转]Javascript实用黑科技45条"><meta name="twitter:description" content="译文链接：Javascript实用黑科技45条
本文是一篇翻译文章。原文： 45 Useful JavaScript Tips, Tricks and Best Practices  

译文开始。"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"Author"}}</script><link rel="canonical" href="http://koala.ink/2015/11/09/javascript_45_black_tech/"><title> [转]Javascript实用黑科技45条 | KoalaInk</title><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-1951963209134581",enable_page_level_ads:!0})</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-85041097-1","auto"),ga("send","pageview")</script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?2ae34fe5bc74dabbd220968d235776a5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div style="display:none"><script src="http://s95.cnzz.com/z_stat.php?id=1260520941&web_id=1260520941" language="JavaScript"></script></div><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">KoalaInk</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Internet King —— Koala</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> Tags</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> About</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div> <span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> [转]Javascript实用黑科技45条</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time itemprop="dateCreated" datetime="2015-11-09T14:56:47+08:00" content="2015-11-09">2015-11-09</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/WEB/" itemprop="url" rel="index"><span itemprop="name">WEB</span></a></span> , <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/WEB/JS/" itemprop="url" rel="index"><span itemprop="name">JS</span></a></span></span> <span id="/2015/11/09/javascript_45_black_tech/" class="leancloud_visitors" data-flag-title="[转]Javascript实用黑科技45条">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">visitors&nbsp;</span><span class="leancloud-visitors-count"></span></span></div><div class="post-banner"></div></header><div class="post-body" itemprop="articleBody"><p>译文链接：<a href="http://blog.gejiawen.com/2015/09/22/45-useful-javascript-tips-tricks-and-best-practices/?utm_source=tuicool&amp;utm_medium=referral">Javascript实用黑科技45条</a></p><p>本文是一篇翻译文章。原文： <a href="http://modernweb.com/2013/12/23/45-useful-javascript-tips-tricks-and-best-practices/">45 Useful JavaScript Tips, Tricks and Best Practices</a></p><hr><p>译文开始。</p><a id="more"></a><p>众所周知，Javascript是全球最流行的语言之一，它涉足Web开发，移动端开发（ <a href="http://phonegap.com/">PhoneGap</a> 、 <a href="http://www.appcelerator.com/">Appcelerator</a> ），服务端开发（ <a href="http://nodejs.org/">Nodejs</a> 、 <a href="https://wakanda.github.io/">Wakanda</a> ），还有多种第三方实现（CoffeeScript这种）。此外Javascript还是许多开发者进入编程世界所接触的第一门语言。它既可以在浏览器中简单的弹出一个alert窗口，也能达到控制机器人这种复杂的程度（比如 <a href="http://nodebots.io/">nodebot</a> 、nodruino）。现在那些能够熟练编写结构清晰、性能卓越的Javascript开发者们，已经成为招聘市场上炙手可热的应聘者了。</p><p>在这篇文章中，我将向你展示一系列Javascript相关的小技巧和一些最佳实践。除了少数几个示例，大部分示例都可以在浏览器环境或者服务端环境适用。</p><p>注意，文章中所有的代码片段都已经在Google Chrome V30(V8 3.20.17.15)测试通过。</p><h2 id="使用-var-关键字进行变量赋值"><a href="#使用-var-关键字进行变量赋值" class="headerlink" title="使用 var 关键字进行变量赋值"></a>使用 <code>var</code> 关键字进行变量赋值</h2><p>在Javascript中，如果一个变量没有经过声明就直接进行赋值操作，那么这个变量就会自动转变成全局变量。我们要尽量避免这种情况（全局变量）。</p><h2 id="使用-来代替-进行判等"><a href="#使用-来代替-进行判等" class="headerlink" title="使用 === 来代替 == 进行判等"></a>使用 <code>===</code> 来代替 <code>==</code> 进行判等</h2><p><code>==</code> 和 <code>!=</code> 操作符会在某些情况下自动进行类型转化。但是 <code>===</code> 和 <code>!==</code>不会做自动转化，它们在做比较时，会同时比较数据类型和值，这也使得 <code>===</code> 和 <code>!==</code> 要比 <code>==</code> 和 <code>!=</code> 的速度要快。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">[<span class="number">10</span>] === <span class="number">10</span>    <span class="comment">// is false</span></div><div class="line">[<span class="number">10</span>]  == <span class="number">10</span>    <span class="comment">// is true</span></div><div class="line"><span class="string">'10'</span> == <span class="number">10</span>     <span class="comment">// is true</span></div><div class="line"><span class="string">'10'</span> === <span class="number">10</span>    <span class="comment">// is false</span></div><div class="line">[] == <span class="number">0</span>        <span class="comment">// is true</span></div><div class="line">[] ===  <span class="number">0</span>      <span class="comment">// is false</span></div><div class="line"><span class="string">''</span> == <span class="literal">false</span>    <span class="comment">// is true but true == "a" is false</span></div><div class="line"><span class="string">''</span> ===   <span class="literal">false</span> <span class="comment">// is false</span></div></pre></td></tr></table></figure><h2 id="undefined-，-null-，0，-false-，-NaN-，-39-39-（空字符串）都为逻辑假值"><a href="#undefined-，-null-，0，-false-，-NaN-，-39-39-（空字符串）都为逻辑假值" class="headerlink" title="undefined ， null ，0， false ， NaN ， &#39;&#39; （空字符串）都为逻辑假值"></a><code>undefined</code> ， <code>null</code> ，<code>0</code>， <code>false</code> ， <code>NaN</code> ， <code>&#39;&#39;</code> （空字符串）都为逻辑假值</h2><h2 id="使用分号-来结束一行代码"><a href="#使用分号-来结束一行代码" class="headerlink" title="使用分号 ; 来结束一行代码"></a>使用分号 <code>;</code> 来结束一行代码</h2><p>使用分号来结束代码行是一个被Javascript社区推荐的最佳实践。如果你忘了也没有关系，因为现在的Javascript引擎将会自动给你加上分号。至于我们为什么应该使用分号，可以参阅这篇文章 <a href="http://davidwalsh.name/javascript-semicolons">http://davidwalsh.name/javascript-semicolons</a> 。</p><h2 id="使用对象构造器"><a href="#使用对象构造器" class="headerlink" title="使用对象构造器"></a>使用对象构造器</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.firstName =  firstName;</div><div class="line">    <span class="keyword">this</span>.lastName = lastName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> Saad = <span class="keyword">new</span> Person(<span class="string">"Saad"</span>, <span class="string">"Mousliki"</span>);</div></pre></td></tr></table></figure><h2 id="使用-typeof-、-instanceof-、-constructor-时要谨慎小心"><a href="#使用-typeof-、-instanceof-、-constructor-时要谨慎小心" class="headerlink" title="使用 typeof 、 instanceof 、 constructor 时要谨慎小心"></a>使用 <code>typeof</code> 、 <code>instanceof</code> 、 <code>constructor</code> 时要谨慎小心</h2><ul><li><code>typeof</code> ：JavaScript的一元操作符，用于以字符串的形式返回变量的原始类型，注意， <code>typeof null</code> 也会返回 <code>object</code> ，大多数的对象类型（数组 <code>Array</code> 、时间 <code>Date</code> 等）也会返回 <code>object</code></li><li><code>constructor</code> ：对象（函数）的内部原型属性，它是可写的（可以被重写）</li><li><code>instanceof</code> ：JavaScript操作符，会在原型链中的构造器中搜索，找到则返回 <code>true</code> ，否则返回 <code>false</code> （常用于判断某一个对象是否是某个构造器或者其父类构造器的实例）</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>];</div><div class="line"><span class="keyword">typeof</span> arr;   <span class="comment">// return "object"</span></div><div class="line">arr <span class="keyword">instanceof</span> <span class="built_in">Array</span> <span class="comment">// true</span></div><div class="line">arr.constructor();  <span class="comment">// []</span></div></pre></td></tr></table></figure><h2 id="学会使用自调用函数"><a href="#学会使用自调用函数" class="headerlink" title="学会使用自调用函数"></a>学会使用自调用函数</h2><p>函数在创建之后直接自动执行，通常称之为自调用匿名函数（Self-Invoked Anonymous Function）或直接调用函数表达式（Immediately Invoked Function Expression ）。比如，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// some private code that will be executed automatically</span></div><div class="line">&#125;)();</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> result = a+b;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;)(<span class="number">10</span>,<span class="number">20</span>);</div></pre></td></tr></table></figure><h2 id="随机从数组中取出一个元素"><a href="#随机从数组中取出一个元素" class="headerlink" title="随机从数组中取出一个元素"></a>随机从数组中取出一个元素</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> items = [<span class="number">12</span>, <span class="number">548</span> , <span class="string">'a'</span> , <span class="number">2</span> , <span class="number">5478</span> , <span class="string">'foo'</span> , <span class="number">8852</span>, , <span class="string">'Doe'</span> , <span class="number">2145</span> , <span class="number">119</span>];</div><div class="line"><span class="keyword">var</span> randomItem = items[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * items.length)];</div></pre></td></tr></table></figure><h2 id="从一个指定的范围中取出一个随机数"><a href="#从一个指定的范围中取出一个随机数" class="headerlink" title="从一个指定的范围中取出一个随机数"></a>从一个指定的范围中取出一个随机数</h2><p>这个功能在生成测试用的假数据时特别有用。比如取一个指定范围内的工资数。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>)) + min;</div></pre></td></tr></table></figure><h2 id="生成一个从0开始到指定数字的序列"><a href="#生成一个从0开始到指定数字的序列" class="headerlink" title="生成一个从0开始到指定数字的序列"></a>生成一个从0开始到指定数字的序列</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> numbersArray = [] , max = <span class="number">100</span>;</div><div class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">1</span>; numbersArray.push(i++) &lt; max;);  <span class="comment">// numbers = [1,2,3 ... 100]</span></div></pre></td></tr></table></figure><h2 id="生成一个随机的字母数字序列"><a href="#生成一个随机的字母数字序列" class="headerlink" title="生成一个随机的字母数字序列"></a>生成一个随机的字母数字序列</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateRandomAlphaNum</span>(<span class="params">len</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> rdmString = <span class="string">""</span>;</div><div class="line">    <span class="keyword">for</span>( ;rdmString.length &lt; len; rdmString  += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>));</div><div class="line">        <span class="keyword">return</span>  rdmString.substr(<span class="number">0</span>, len);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>译者注</p><p><code>toString()</code> 方法可以接受一个参数表示数字进制。而36进制刚好可以使用a-z和0-9这些字符。所以此方法可以用于生成简单的随机串。</p><h2 id="打乱一个数字数组的顺序"><a href="#打乱一个数字数组的顺序" class="headerlink" title="打乱一个数字数组的顺序"></a>打乱一个数字数组的顺序</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>, <span class="number">458</span> , <span class="number">120</span> , <span class="number">-215</span> , <span class="number">228</span> , <span class="number">400</span> , <span class="number">122205</span>, <span class="number">-85411</span>];</div><div class="line">numbers = numbers.sort(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="built_in">Math</span>.random() - <span class="number">0.5</span>&#125;);</div><div class="line"><span class="comment">/* the array numbers will be equal for example to [120, 5, 228, -215, 400, 458, -85411, 122205]  */</span></div></pre></td></tr></table></figure><p>这里采用了原生的排序函数 <code>sort()</code> ，此外我们还可以使用专门的工具库来得到这一目的。</p><h2 id="字符串去空格"><a href="#字符串去空格" class="headerlink" title="字符串去空格"></a>字符串去空格</h2><p>像Java、C#、PHP这些语言都内置了 <code>trim()</code> 功能函数用于字符串去空格。但是Javascript没有这个内置方法。可以通过下面的方法来得到此目的，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="built_in">String</span>.prototype.trim = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">""</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>不过，在新的Javascript引擎中，已经内置支持了这个功能。</p><h2 id="将一个数组追加到另一个数组中"><a href="#将一个数组追加到另一个数组中" class="headerlink" title="将一个数组追加到另一个数组中"></a>将一个数组追加到另一个数组中</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> array1 = [<span class="number">12</span> , <span class="string">"foo"</span> , &#123;name <span class="string">"Joe"</span>&#125; , <span class="number">-2458</span>];</div><div class="line"><span class="keyword">var</span> array2 = [<span class="string">"Doe"</span> , <span class="number">555</span> , <span class="number">100</span>];</div><div class="line"><span class="built_in">Array</span>.prototype.push.apply(array1, array2);</div><div class="line"><span class="comment">/* array1 值为  [12 , "foo" , &#123;name "Joe"&#125; , -2458 , "Doe" , 555 , 100] */</span></div></pre></td></tr></table></figure><h2 id="将-argruments-转换成数组"><a href="#将-argruments-转换成数组" class="headerlink" title="将 argruments 转换成数组"></a>将 <code>argruments</code> 转换成数组</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> argArray = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</div></pre></td></tr></table></figure><h2 id="检验一个参数是否为数字"><a href="#检验一个参数是否为数字" class="headerlink" title="检验一个参数是否为数字"></a>检验一个参数是否为数字</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumber</span>(<span class="params">n</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseFloat</span>(n)) &amp;&amp; <span class="built_in">isFinite</span>(n);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="检验一个参数是否为数组"><a href="#检验一个参数是否为数组" class="headerlink" title="检验一个参数是否为数组"></a>检验一个参数是否为数组</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Array]'</span> ;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>如果 <code>toString()</code> 被重写过的话，上面的方法就不行了。此时我们可以使用下面的方法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="built_in">Array</span>.isArray(obj); <span class="comment">// its a new Array method</span></div></pre></td></tr></table></figure><p>如果在浏览器中没有使用iframe，还可以用 <code>instanceof</code> ，但如果上下文太复杂，也有可能出错。比如，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> myFrame = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</div><div class="line"><span class="built_in">document</span>.body.appendChild(myFrame);</div><div class="line"></div><div class="line"><span class="keyword">var</span> myArray = <span class="built_in">window</span>.frames[<span class="built_in">window</span>.frames.length<span class="number">-1</span>].Array;</div><div class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> myArray(a,b,<span class="number">10</span>); <span class="comment">// [a,b,10]</span></div><div class="line"></div><div class="line"><span class="comment">// myArray 的构造器已经丢失，instanceof 的结果将不正常</span></div><div class="line"><span class="comment">// 不同iframe中的构造器是不能共享的</span></div><div class="line">arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// false</span></div></pre></td></tr></table></figure><h2 id="取出一个数组中的最大值和最小值"><a href="#取出一个数组中的最大值和最小值" class="headerlink" title="取出一个数组中的最大值和最小值"></a>取出一个数组中的最大值和最小值</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>, <span class="number">458</span> , <span class="number">120</span> , <span class="number">-215</span> , <span class="number">228</span> , <span class="number">400</span> , <span class="number">122205</span>, <span class="number">-85411</span>];</div><div class="line"><span class="keyword">var</span> maxInNumbers = <span class="built_in">Math</span>.max.apply(<span class="built_in">Math</span>, numbers);</div><div class="line"><span class="keyword">var</span> minInNumbers = <span class="built_in">Math</span>.min.apply(<span class="built_in">Math</span>, numbers);</div></pre></td></tr></table></figure><h2 id="清空一个数组"><a href="#清空一个数组" class="headerlink" title="清空一个数组"></a>清空一个数组</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> myArray = [<span class="number">12</span> , <span class="number">222</span> , <span class="number">1000</span> ];  </div><div class="line">myArray.length = <span class="number">0</span>; <span class="comment">// myArray will be equal to [].</span></div></pre></td></tr></table></figure><h2 id="不用使用-delete-关键字来移除一个数组元素"><a href="#不用使用-delete-关键字来移除一个数组元素" class="headerlink" title="不用使用 delete 关键字来移除一个数组元素"></a>不用使用 delete 关键字来移除一个数组元素</h2><p>应该使用 <code>splice</code> 方法而不是 <code>delete</code> 来移除一个数组元素。对一个数组元素使用 <code>delete</code> 会让这个数组元素的值变为 <code>undefined</code> ，并没有将这个数组元素给删除掉。</p><p>错误的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> items = [<span class="number">12</span>, <span class="number">548</span> ,<span class="string">'a'</span> , <span class="number">2</span> , <span class="number">5478</span> , <span class="string">'foo'</span> , <span class="number">8852</span>, , <span class="string">'Doe'</span> ,<span class="number">2154</span> , <span class="number">119</span> ];</div><div class="line">items.length; <span class="comment">// return 11</span></div><div class="line"><span class="keyword">delete</span> items[<span class="number">3</span>]; <span class="comment">// return true</span></div><div class="line">items.length; <span class="comment">// return 11</span></div><div class="line"><span class="comment">/* items will be equal to [12, 548, "a", undefined × 1, 5478, "foo", 8852, undefined × 1, "Doe", 2154,       119]   */</span></div></pre></td></tr></table></figure><p>正确的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> items = [<span class="number">12</span>, <span class="number">548</span> ,<span class="string">'a'</span> , <span class="number">2</span> , <span class="number">5478</span> , <span class="string">'foo'</span> , <span class="number">8852</span>, , <span class="string">'Doe'</span> ,<span class="number">2154</span> , <span class="number">119</span> ];</div><div class="line">items.length; <span class="comment">// return 11</span></div><div class="line">items.splice(<span class="number">3</span>,<span class="number">1</span>) ;</div><div class="line">items.length; <span class="comment">// return 10</span></div><div class="line"><span class="comment">/* items 结果为 [12, 548, "a", 5478, "foo", 8852, undefined × 1, "Doe", 2154, 119] */</span></div></pre></td></tr></table></figure><p>注意，要想移除一个对象的属性，应该采用 <code>delete</code> 方法。</p><h2 id="可以通过操作数组长度-length-来截断一个数组"><a href="#可以通过操作数组长度-length-来截断一个数组" class="headerlink" title="可以通过操作数组长度 length 来截断一个数组"></a>可以通过操作数组长度 length 来截断一个数组</h2><p>与前面那个使用 <code>length</code> 清空数组的示例类似，我们可以使用 <code>length</code> 来截断一个数组。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> myArray = [<span class="number">12</span> , <span class="number">222</span> , <span class="number">1000</span> , <span class="number">124</span> , <span class="number">98</span> , <span class="number">10</span> ];  </div><div class="line">myArray.length = <span class="number">4</span>; <span class="comment">// myArray will be equal to [12 , 222 , 1000 , 124].</span></div></pre></td></tr></table></figure><p>除此之外，如果我们使用一个更大的值去重写 <code>length</code> ，那么数组的长度将会改变，同时会用 <code>undefined</code> 填充新增的数组元素。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">myArray.length = <span class="number">10</span>; <span class="comment">// the new array length is 10</span></div><div class="line">myArray[myArray.length - <span class="number">1</span>] ; <span class="comment">// undefined</span></div></pre></td></tr></table></figure><h2 id="在条件中使用-amp-amp-及-进行短语判断"><a href="#在条件中使用-amp-amp-及-进行短语判断" class="headerlink" title="在条件中使用 &amp;&amp; 及 || 进行短语判断"></a>在条件中使用 <code>&amp;&amp;</code> 及 <code>||</code> 进行短语判断</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="number">10</span>;  </div><div class="line">foo == <span class="number">10</span> &amp;&amp; doSomething(); <span class="comment">// is the same thing as if (foo == 10) doSomething();</span></div><div class="line">foo == <span class="number">5</span> || doSomething(); <span class="comment">// is the same thing as if (foo != 5) doSomething();</span></div></pre></td></tr></table></figure><p><code>||</code> 还用于给函数参数设置默认值，比如</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">arg1</span>)</span>&#123;</div><div class="line">    arg1 = arg1 || <span class="number">10</span>; <span class="comment">// arg1 will have 10 as a default value if it’s not already set</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="使用-map-对数组进行遍历操作"><a href="#使用-map-对数组进行遍历操作" class="headerlink" title="使用 map() 对数组进行遍历操作"></a>使用 <code>map()</code> 对数组进行遍历操作</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> squares = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].map(<span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;  </div><div class="line">    <span class="keyword">return</span> val * val;  </div><div class="line">&#125;);</div><div class="line"><span class="comment">// squares will be equal to [1, 4, 9, 16]</span></div></pre></td></tr></table></figure><h2 id="保留指定位数的小数点"><a href="#保留指定位数的小数点" class="headerlink" title="保留指定位数的小数点"></a>保留指定位数的小数点</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2.443242342</span>;</div><div class="line">num = num.toFixed(<span class="number">4</span>);  <span class="comment">// num will be equal to 2.4432</span></div></pre></td></tr></table></figure><p>注意， <code>toFixed()</code> 方法返回的是字符串而不是一个数字。</p><h2 id="浮点数计算问题"><a href="#浮点数计算问题" class="headerlink" title="浮点数计算问题"></a>浮点数计算问题</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span> <span class="comment">// is false</span></div><div class="line"><span class="number">9007199254740992</span> + <span class="number">1</span> <span class="comment">// is equal to 9007199254740992  </span></div><div class="line"><span class="number">9007199254740992</span> + <span class="number">2</span> <span class="comment">// is equal to 9007199254740994</span></div></pre></td></tr></table></figure><p>为什么呢？因为0.1+0.2等于0.30000000000000004。JavaScript的数字都遵循IEEE 754标准构建，在内部都是64位浮点小数表示，具体可以参阅 <a href="http://www.2ality.com/2012/04/number-encoding.html">这篇文章</a> 。</p><p>另外，你也可以使用 <code>toFixed()</code> 或者 <code>toPrecision()</code> 来解决这个问题。</p><p>译者注</p><p>关于这个问题，博主也有一篇相关的文章， <a href="http://blog.gejiawen.com/2015/08/11/javascript-float-count-precision/">Javascript中浮点数的计算精度问题</a> 。</p><h2 id="使用-for-in-来遍历对象的属性"><a href="#使用-for-in-来遍历对象的属性" class="headerlink" title="使用 for...in 来遍历对象的属性"></a>使用 <code>for...in</code> 来遍历对象的属性</h2><p>下面的代码片段使用 <code>for...in</code> 来遍历对象属性，可以防止遍历到对象原型链上的属性。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> object) &#123;  </div><div class="line">    <span class="keyword">if</span> (object.hasOwnProperty(name)) &#123;</div><div class="line">        <span class="comment">// do something with name                    </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="逗号运算符"><a href="#逗号运算符" class="headerlink" title="逗号运算符"></a>逗号运算符</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">0</span>;</div><div class="line"><span class="keyword">var</span> b = ( a++, <span class="number">99</span> );</div><div class="line"><span class="built_in">console</span>.log(a);  <span class="comment">// a will be equal to 1</span></div><div class="line"><span class="built_in">console</span>.log(b);  <span class="comment">// b is equal to 99</span></div></pre></td></tr></table></figure><h2 id="缓存临时变量用于避免再次计算或者查询"><a href="#缓存临时变量用于避免再次计算或者查询" class="headerlink" title="缓存临时变量用于避免再次计算或者查询"></a>缓存临时变量用于避免再次计算或者查询</h2><p>在使用jquery时，我们可以临时缓存整个jq对象，比如</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> navright = <span class="built_in">document</span>.querySelector(<span class="string">'#right'</span>);</div><div class="line"><span class="keyword">var</span> navleft = <span class="built_in">document</span>.querySelector(<span class="string">'#left'</span>);</div><div class="line"><span class="keyword">var</span> navup = <span class="built_in">document</span>.querySelector(<span class="string">'#up'</span>);</div><div class="line"><span class="keyword">var</span> navdown = <span class="built_in">document</span>.querySelector(<span class="string">'#down'</span>);</div></pre></td></tr></table></figure><h2 id="提前检查传入-isFinite-的参数"><a href="#提前检查传入-isFinite-的参数" class="headerlink" title="提前检查传入 isFinite() 的参数"></a>提前检查传入 <code>isFinite()</code> 的参数</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="built_in">isFinite</span>(<span class="number">0</span>/<span class="number">0</span>) ; <span class="comment">// false</span></div><div class="line"><span class="built_in">isFinite</span>(<span class="string">"foo"</span>); <span class="comment">// false</span></div><div class="line"><span class="built_in">isFinite</span>(<span class="string">"10"</span>); <span class="comment">// true</span></div><div class="line"><span class="built_in">isFinite</span>(<span class="number">10</span>);   <span class="comment">// true</span></div><div class="line"><span class="built_in">isFinite</span>(<span class="literal">undefined</span>);  <span class="comment">// false</span></div><div class="line"><span class="built_in">isFinite</span>();   <span class="comment">// false</span></div><div class="line"><span class="built_in">isFinite</span>(<span class="literal">null</span>);  <span class="comment">// true  注意这里！！！</span></div></pre></td></tr></table></figure><h2 id="避免对数组进行负值索引"><a href="#避免对数组进行负值索引" class="headerlink" title="避免对数组进行负值索引"></a>避免对数组进行负值索引</h2><figure class="highlight"><table><tr><td class="code"><pre><div class="line">var numbersArray = [1,2,3,4,5];</div><div class="line">var from = numbersArray.indexOf("foo") ;  // from is equal to -1</div><div class="line">numbersArray.splice(from,2);    // will return [5]</div><div class="line">``</div><div class="line">注意传给 `splice` 的索引参数不要是负数，当是负数时，会从数组结尾处删除元素。  </div><div class="line"></div><div class="line">## 使用 JSON 来进行序列化和反序列化  </div><div class="line"></div><div class="line">```javascript</div><div class="line">var person = &#123;name :'Saad', age : 26, department : &#123;ID : 15, name : "R&amp;D"&#125; &#125;;</div><div class="line">var stringFromPerson = JSON.stringify(person);</div><div class="line">/* stringFromPerson is equal to "&#123;"name":"Saad","age":26,"department":&#123;"ID":15,"name":"R&amp;D"&#125;&#125;"   */</div><div class="line">var personFromString = JSON.parse(stringFromPerson);  </div><div class="line">/* personFromString is equal to person object  */</div></pre></td></tr></table></figure><h2 id="避免使用-eval-和函数构造器"><a href="#避免使用-eval-和函数构造器" class="headerlink" title="避免使用 eval() 和函数构造器"></a>避免使用 eval() 和函数构造器</h2><p><code>eval()</code> 和函数构造器（ <code>Function consturctor</code>）的开销都比较大，每次调用JavaScript引擎都要将源代码转换为可执行的代码。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> func1 = <span class="keyword">new</span> <span class="built_in">Function</span>(functionCode);</div><div class="line"><span class="keyword">var</span> func2 = <span class="built_in">eval</span>(functionCode);</div></pre></td></tr></table></figure><h2 id="避免使用-with"><a href="#避免使用-with" class="headerlink" title="避免使用 with()"></a>避免使用 <code>with()</code></h2><p>使用 <code>with()</code> 语法会将变量注入到全局变量中。因此，如果有重名的变量，就会发生覆盖或者重写的问题。</p><h2 id="避免使用-for-in-遍历数组"><a href="#避免使用-for-in-遍历数组" class="headerlink" title="避免使用 for...in 遍历数组"></a>避免使用 <code>for...in</code> 遍历数组</h2><p>错误的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;  </div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> arrayNumbers) &#123;  </div><div class="line">    sum += arrayNumbers[i];  </div><div class="line">&#125;</div></pre></td></tr></table></figure><p>更好的做法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;  </div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = arrayNumbers.length; i &lt; len; i++) &#123;  </div><div class="line">    sum += arrayNumbers[i];  </div><div class="line">&#125;</div></pre></td></tr></table></figure><p>除此之外， <code>i</code> 和 <code>len</code> 是在 <code>for</code> 循环的第一个声明中，二者只会初始化一次，这要比下面这种写法快：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayNumbers.length; i++)</div></pre></td></tr></table></figure><p>为什么呢？因为数组 <code>arrayNumbers</code> 的长度在每次遍历的时候都会计算一次，这就造成了不必要的消耗。</p><p>注意，这个问题其实在最新的Javascript引擎中已经被修复了。</p><h2 id="给-setTimeout-及-setInterval-传递函数而不是字符串更好"><a href="#给-setTimeout-及-setInterval-传递函数而不是字符串更好" class="headerlink" title="给 setTimeout() 及 setInterval() 传递函数而不是字符串更好"></a>给 <code>setTimeout()</code> 及 <code>setInterval()</code> 传递函数而不是字符串更好</h2><p>如果你给 <code>setTimeout()</code> 或者 <code>setInterval()</code> 传递字符串的话，那么它内部的执行机制其实是和 <code>eval()</code> 是一样的，这样会比较慢。</p><p>错误的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">setInterval(<span class="string">'doSomethingPeriodically()'</span>, <span class="number">1000</span>);  </div><div class="line">setTimeout(<span class="string">'doSomethingAfterFiveSeconds()'</span>, <span class="number">5000</span>);</div></pre></td></tr></table></figure><p>正确的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">setInterval(doSomethingPeriodically, <span class="number">1000</span>);  </div><div class="line">setTimeout(doSomethingAfterFiveSeconds, <span class="number">5000</span>);</div></pre></td></tr></table></figure><h2 id="使用-switch-case-来代替一坨-if-else"><a href="#使用-switch-case-来代替一坨-if-else" class="headerlink" title="使用 switch/case 来代替一坨 if/else"></a>使用 <code>switch/case</code> 来代替一坨 <code>if/else</code></h2><p>当判断有超过两个分支的时候使用 <code>switch/case</code> 要更快一些，而且也更优雅，更利于代码的组织，当然，如果有超过10个分支，就不要使用 <code>switch/case</code> 了。</p><h2 id="在-switch-case-中使用数字范围进行分界"><a href="#在-switch-case-中使用数字范围进行分界" class="headerlink" title="在 switch/case 中使用数字范围进行分界"></a>在 <code>switch/case</code> 中使用数字范围进行分界</h2><p>其实 <code>switch/case</code> 中的 <code>case</code> 条件，还可以这样写：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCategory</span>(<span class="params">age</span>) </span>&#123;  </div><div class="line">    <span class="keyword">var</span> category = <span class="string">""</span>;  </div><div class="line">    <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;  </div><div class="line">        <span class="keyword">case</span> <span class="built_in">isNaN</span>(age):  </div><div class="line">            category = <span class="string">"not an age"</span>;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> (age &gt;= <span class="number">50</span>):  </div><div class="line">            category = <span class="string">"Old"</span>;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> (age &lt;= <span class="number">20</span>):  </div><div class="line">            category = <span class="string">"Baby"</span>;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">default</span>:  </div><div class="line">            category = <span class="string">"Young"</span>;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">    &#125;;  </div><div class="line">    <span class="keyword">return</span> category;  </div><div class="line">&#125;  </div><div class="line">getCategory(<span class="number">5</span>);  <span class="comment">// will return "Baby"</span></div></pre></td></tr></table></figure><h2 id="为创建的对象指定原型"><a href="#为创建的对象指定原型" class="headerlink" title="为创建的对象指定原型"></a>为创建的对象指定原型</h2><p>下面的示例演示了可以给定对象作为参数，来创建以此为原型的新对象：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">object</span>) </span>&#123;  </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">OneShotConstructor</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">    OneShotConstructor.prototype = object;  </div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OneShotConstructor();</div><div class="line">&#125;</div><div class="line">clone(<span class="built_in">Array</span>).prototype ;  <span class="comment">// []</span></div></pre></td></tr></table></figure><h2 id="html转义函数"><a href="#html转义函数" class="headerlink" title="html转义函数"></a>html转义函数</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">escapeHTML</span>(<span class="params">text</span>) </span>&#123;  </div><div class="line">    <span class="keyword">var</span> replacements= &#123;<span class="string">'&lt;'</span>: <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>: <span class="string">'&gt;'</span>, <span class="string">'&amp;'</span>: <span class="string">'&amp;'</span>, <span class="string">'"'</span>: <span class="string">'"'</span>&#125;;                      </div><div class="line">    <span class="keyword">return</span> text.replace(<span class="regexp">/[&lt;&gt;&amp;"]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">character</span>) </span>&#123;  </div><div class="line">        <span class="keyword">return</span> replacements[character];  </div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="不要在循环中使用-try-catch-finally"><a href="#不要在循环中使用-try-catch-finally" class="headerlink" title="不要在循环中使用 try...catch...finally"></a>不要在循环中使用 <code>try...catch...finally</code></h2><p><code>try...catch...finally</code> 在捕获一个异常时，会创建一个运行时环境的子作用域。而异常变量的生命周期仅限在这个运行时的子作用域。</p><p>译者注</p><p>这里我们可以使用闭包来保存这个运行时的异常变量。</p><p>错误的用法</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> object = [<span class="string">'foo'</span>, <span class="string">'bar'</span>], i;  </div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, len = object.length; i &lt;len; i++) &#123;  </div><div class="line">    <span class="keyword">try</span> &#123;  </div><div class="line">        <span class="comment">// do something that throws an exception</span></div><div class="line">    &#125; <span class="keyword">catch</span> (e) &#123;   </div><div class="line">        <span class="comment">// handle exception  </span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>正确的用法</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> object = [<span class="string">'foo'</span>, <span class="string">'bar'</span>], i;  </div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, len = object.length; i &lt;len; i++) &#123;  </div><div class="line">        <span class="comment">// do something that throws an exception</span></div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;   </div><div class="line">    <span class="comment">// handle exception  </span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="使用-XMLHttpRequests-时注意设置超时参数"><a href="#使用-XMLHttpRequests-时注意设置超时参数" class="headerlink" title="使用 XMLHttpRequests 时注意设置超时参数"></a>使用 <code>XMLHttpRequests</code> 时注意设置超时参数</h2><p>如果一个ajax请求长时间没有响应，我们应该中止请求。否则浏览器将会一直等待。我们可以使用 <code>setTimeout()</code> 来做一个定时器，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest ();</div><div class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.readyState == <span class="number">4</span>) &#123;  </div><div class="line">        clearTimeout(timeout);  </div><div class="line">        <span class="comment">// do something with response data</span></div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line"><span class="keyword">var</span> timeout = setTimeout( <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">    xhr.abort(); <span class="comment">// call error callback  </span></div><div class="line">&#125;, <span class="number">60</span>*<span class="number">1000</span> <span class="comment">/* timeout after a minute */</span> );</div><div class="line">xhr.open(<span class="string">'GET'</span>, url, <span class="literal">true</span>);  </div><div class="line">xhr.send();</div></pre></td></tr></table></figure><p>除此之外，我们应该避免同时发送多个 同步的 ajax请求。</p><h2 id="处理websocket超时"><a href="#处理websocket超时" class="headerlink" title="处理websocket超时"></a>处理websocket超时</h2><p>一般地，WebSocket连接创建后，如果30秒内没有任何活动服务器端会对连接进行超时处理，防火墙也可以对单位周期内没有活动的连接进行超时处理。</p><p>为了防止超时中断，你需要每隔一段时间发送一个心跳数据（空字符串）以保持websocket连接。下面的两个方法一个用于周期的发送心跳数据保持连接，一个是取消心跳数据包。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> timerID = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">keepAlive</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> timeout = <span class="number">15000</span>;</div><div class="line">    <span class="keyword">if</span> (webSocket.readyState == webSocket.OPEN) &#123;</div><div class="line">        webSocket.send(<span class="string">''</span>);</div><div class="line">    &#125;</div><div class="line">    timerId = setTimeout(keepAlive, timeout);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cancelKeepAlive</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (timerId) &#123;</div><div class="line">        cancelTimeout(timerId);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>keepAlive()</code> 方法应该被添加在 <code>webSOcket</code> 连接的 <code>onOpen()</code> 方法的最后，而 <code>cancelKeepAlive()</code> 添加在 <code>onClose()</code> 方法的最后。</p><h2 id="记住：原生操作肯定比函数调用要效率高"><a href="#记住：原生操作肯定比函数调用要效率高" class="headerlink" title="记住：原生操作肯定比函数调用要效率高"></a>记住：原生操作肯定比函数调用要效率高</h2><p>比如，</p><p>错误的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> min = <span class="built_in">Math</span>.min(a,b);</div><div class="line">A.push(v);</div></pre></td></tr></table></figure><p>正确的用法，</p><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> min = a &lt; b ? a : b;</div><div class="line">A[A.length] = v;</div></pre></td></tr></table></figure><h2 id="编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。"><a href="#编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。" class="headerlink" title="编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。"></a>编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。</h2><h2 id="Javascript是一门很吊的语言，这里还有很多资源，"><a href="#Javascript是一门很吊的语言，这里还有很多资源，" class="headerlink" title="Javascript是一门很吊的语言，这里还有很多资源，"></a>Javascript是一门很吊的语言，这里还有很多资源，</h2><ul><li>Code Academy JavaScript tracks: <a href="http://www.codecademy.com/tracks/javascript">http://www.codecademy.com/tracks/javascript</a></li><li>Eloquent JavaScript by Marjin Haverbeke: <a href="http://eloquentjavascript.net/">http://eloquentjavascript.net/</a></li><li>Advanced JavaScript by John Resig: <a href="http://ejohn.org/apps/learn/">http://ejohn.org/apps/learn/</a></li></ul><hr><p>本文链接：<a href="/2015/11/09/javascript_45_black_tech/">[转]Javascript实用黑科技45条</a></p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/JS/" rel="tag">#JS</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2015/11/03/html_bfc/" rel="next" title="BFC的概念及应用与原理"><i class="fa fa-chevron-left"></i> BFC的概念及应用与原理</a></div><div class="post-nav-prev post-nav-item"> <a href="/2015/11/09/mobile_web_assets_resource_arrangement/" rel="prev" title="[转]移动web资源整理">[转]移动web资源整理<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div onclick="ShowGitment()" id="gitment-display-button">Show comments from Gitment</div><div id="gitment-container" style="display:none"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview"> Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Koala.ink"><p class="site-author-name" itemprop="name">Koala.ink</p><p class="site-description motion-element" itemprop="description">Coding my future.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">34</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">17</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">36</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/koalaink" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-var-关键字进行变量赋值"><span class="nav-number">0.</span> <span class="nav-text">使用 var 关键字进行变量赋值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-来代替-进行判等"><span class="nav-number">1.</span> <span class="nav-text">使用 === 来代替 == 进行判等</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined-，-null-，0，-false-，-NaN-，-39-39-（空字符串）都为逻辑假值"><span class="nav-number">2.</span> <span class="nav-text">undefined ， null ，0， false ， NaN ， '' （空字符串）都为逻辑假值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用分号-来结束一行代码"><span class="nav-number">3.</span> <span class="nav-text">使用分号 ; 来结束一行代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用对象构造器"><span class="nav-number">4.</span> <span class="nav-text">使用对象构造器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-typeof-、-instanceof-、-constructor-时要谨慎小心"><span class="nav-number">5.</span> <span class="nav-text">使用 typeof 、 instanceof 、 constructor 时要谨慎小心</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#学会使用自调用函数"><span class="nav-number">6.</span> <span class="nav-text">学会使用自调用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随机从数组中取出一个元素"><span class="nav-number">7.</span> <span class="nav-text">随机从数组中取出一个元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从一个指定的范围中取出一个随机数"><span class="nav-number">8.</span> <span class="nav-text">从一个指定的范围中取出一个随机数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成一个从0开始到指定数字的序列"><span class="nav-number">9.</span> <span class="nav-text">生成一个从0开始到指定数字的序列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成一个随机的字母数字序列"><span class="nav-number">10.</span> <span class="nav-text">生成一个随机的字母数字序列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打乱一个数字数组的顺序"><span class="nav-number">11.</span> <span class="nav-text">打乱一个数字数组的顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串去空格"><span class="nav-number">12.</span> <span class="nav-text">字符串去空格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将一个数组追加到另一个数组中"><span class="nav-number">13.</span> <span class="nav-text">将一个数组追加到另一个数组中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将-argruments-转换成数组"><span class="nav-number">14.</span> <span class="nav-text">将 argruments 转换成数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检验一个参数是否为数字"><span class="nav-number">15.</span> <span class="nav-text">检验一个参数是否为数字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检验一个参数是否为数组"><span class="nav-number">16.</span> <span class="nav-text">检验一个参数是否为数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#取出一个数组中的最大值和最小值"><span class="nav-number">17.</span> <span class="nav-text">取出一个数组中的最大值和最小值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清空一个数组"><span class="nav-number">18.</span> <span class="nav-text">清空一个数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不用使用-delete-关键字来移除一个数组元素"><span class="nav-number">19.</span> <span class="nav-text">不用使用 delete 关键字来移除一个数组元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以通过操作数组长度-length-来截断一个数组"><span class="nav-number">20.</span> <span class="nav-text">可以通过操作数组长度 length 来截断一个数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在条件中使用-amp-amp-及-进行短语判断"><span class="nav-number">21.</span> <span class="nav-text">在条件中使用 && 及 || 进行短语判断</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-map-对数组进行遍历操作"><span class="nav-number">22.</span> <span class="nav-text">使用 map() 对数组进行遍历操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保留指定位数的小数点"><span class="nav-number">23.</span> <span class="nav-text">保留指定位数的小数点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浮点数计算问题"><span class="nav-number">24.</span> <span class="nav-text">浮点数计算问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-for-in-来遍历对象的属性"><span class="nav-number">25.</span> <span class="nav-text">使用 for...in 来遍历对象的属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逗号运算符"><span class="nav-number">26.</span> <span class="nav-text">逗号运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存临时变量用于避免再次计算或者查询"><span class="nav-number">27.</span> <span class="nav-text">缓存临时变量用于避免再次计算或者查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提前检查传入-isFinite-的参数"><span class="nav-number">28.</span> <span class="nav-text">提前检查传入 isFinite() 的参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#避免对数组进行负值索引"><span class="nav-number">29.</span> <span class="nav-text">避免对数组进行负值索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#避免使用-eval-和函数构造器"><span class="nav-number">30.</span> <span class="nav-text">避免使用 eval() 和函数构造器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#避免使用-with"><span class="nav-number">31.</span> <span class="nav-text">避免使用 with()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#避免使用-for-in-遍历数组"><span class="nav-number">32.</span> <span class="nav-text">避免使用 for...in 遍历数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#给-setTimeout-及-setInterval-传递函数而不是字符串更好"><span class="nav-number">33.</span> <span class="nav-text">给 setTimeout() 及 setInterval() 传递函数而不是字符串更好</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-switch-case-来代替一坨-if-else"><span class="nav-number">34.</span> <span class="nav-text">使用 switch/case 来代替一坨 if/else</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在-switch-case-中使用数字范围进行分界"><span class="nav-number">35.</span> <span class="nav-text">在 switch/case 中使用数字范围进行分界</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为创建的对象指定原型"><span class="nav-number">36.</span> <span class="nav-text">为创建的对象指定原型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#html转义函数"><span class="nav-number">37.</span> <span class="nav-text">html转义函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不要在循环中使用-try-catch-finally"><span class="nav-number">38.</span> <span class="nav-text">不要在循环中使用 try...catch...finally</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-XMLHttpRequests-时注意设置超时参数"><span class="nav-number">39.</span> <span class="nav-text">使用 XMLHttpRequests 时注意设置超时参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理websocket超时"><span class="nav-number">40.</span> <span class="nav-text">处理websocket超时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记住：原生操作肯定比函数调用要效率高"><span class="nav-number">41.</span> <span class="nav-text">记住：原生操作肯定比函数调用要效率高</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。"><span class="nav-number">42.</span> <span class="nav-text">编码时注意保持代码的优雅格式，上生产环境前做一些压缩工作。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Javascript是一门很吊的语言，这里还有很多资源，"><span class="nav-number">43.</span> <span class="nav-text">Javascript是一门很吊的语言，这里还有很多资源，</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 - <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-fw fa-github"></i></span> <span class="author" itemprop="copyrightHolder"><a class="hosted-link" href="/">Koala.ink</a></span></div><div class="hosted-on"> Hosted on<a class="hosted-link" href="https://github.com/koalaink/koalaink.github.io"><i class="fa fa-fw fa-github"></i> GitHub</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script type="text/javascript">function ShowGitment(){document.getElementById("gitment-display-button").style.display="none",document.getElementById("gitment-container").style.display="block";var e=new Gitment({id:document.location.href,owner:"KoalaInk",repo:"koalaink.github.io",oauth:{client_id:"050fc13519ecf4c906f1",client_secret:"3089171e76120c5937013151ad8577141fde9141"}});e.render("gitment-container")}</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),s=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!0,s=r.title.trim().toLowerCase(),n=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=r.url,o=-1,l=-1,p=-1;if(""!=s&&""!=n&&a.forEach(function(e,t){o=s.indexOf(e),l=n.indexOf(e),o<0&&l<0?c=!1:(l<0&&(l=0),0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+i+"' class='search-result-title'>"+s+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),s.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("MAsnSi44NPvCiO2yaUFaS9xP-gzGzoHsz","KbDduhEI6reqUU4FFU5Jz1wk")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),c=s.get("time"),l=document.getElementById(r);$(l).find(t).text(c)}for(var i=0;i<n.length;i++){var r=n[i],l=document.getElementById(r),u=$(l).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e,t){var n=$(".leancloud_visitors"),o=n.attr("id").trim(),i=n.attr("data-flag-title").trim(),s=new AV.Query(e);s.equalTo("url",o),s.find({success:function(t){if(t.length>0){var n=t[0];n.fetchWhenSave(!0),n.increment("time"),n.save(null,{success:function(e){var t=$(document.getElementById(o));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",i),s.set("url",o),s.set("time",1),s.save(null,{success:function(e){var t=$(document.getElementById(o));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}});var r=new t,c=new AV.ACL;c.setPublicReadAccess(!0),c.setPublicWriteAccess(!0),r.setACL(c),r.set("title",i),r.set("url",o),r.set("time",1),r.save(null,{success:function(e){},error:function(e,t){console.log("Failed to create")}})}$(function(){var e=AV.Object.extend("Counter"),t=AV.Object.extend("History");1==$(".leancloud_visitors").length?addCount(e,t):$(".post-title-link").length>1&&showTime(e)})</script></body></html>